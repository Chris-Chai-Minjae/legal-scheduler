<%= content_for :title, "ì¹´ë“œ ë‚´ì—­ ìƒì„¸" %>

<style>
  .detail-container { max-width: 1100px; margin: 0 auto; padding: 2rem; }
  .detail-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem; }
  .detail-title { font-size: 1.5rem; font-weight: 700; color: #1a1a2e; }
  .detail-meta { color: #6b7280; font-size: 0.9rem; margin-top: 0.25rem; }
  .status-card { display: flex; gap: 1.5rem; margin-bottom: 2rem; }
  .stat-box { flex: 1; background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); text-align: center; }
  .stat-value { font-size: 1.75rem; font-weight: 700; color: #1a1a2e; }
  .stat-label { font-size: 0.85rem; color: #6b7280; margin-top: 0.25rem; }
  .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; margin-top: 0.75rem; overflow: hidden; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, #3b82f6, #2563eb); border-radius: 4px; transition: width 0.3s; }

  .expense-table-card { background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
  .table-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
  .table-title { font-size: 1.1rem; font-weight: 600; }
  .filters { display: flex; gap: 0.75rem; }
  .filter-select { padding: 0.5rem 1rem; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.85rem; background: white; }

  .expense-table { width: 100%; border-collapse: separate; border-spacing: 0; }
  .expense-table th { padding: 0.75rem 1rem; font-size: 0.8rem; font-weight: 600; color: #6b7280; text-align: left; border-bottom: 2px solid #e5e7eb; text-transform: uppercase; }
  .expense-table td { padding: 0.75rem 1rem; font-size: 0.9rem; border-bottom: 1px solid #f3f4f6; }
  .expense-table tr:hover { background: #f8fafc; }
  .amount-cell { font-weight: 600; color: #1a1a2e; text-align: right; }
  .category-badge { padding: 2px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: 500; background: #eff6ff; color: #1e40af; }
  .back-link { display: inline-flex; align-items: center; gap: 0.5rem; color: #3b82f6; text-decoration: none; font-size: 0.9rem; margin-bottom: 1rem; }
  .back-link:hover { text-decoration: underline; }
  .btn-report { padding: 0.6rem 1.2rem; background: #2563eb; color: white; border: none; border-radius: 8px; font-size: 0.85rem; font-weight: 500; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; }
  .btn-report:hover { background: #1d4ed8; }
</style>

<div class="detail-container">
  <%= link_to expenses_card_statements_path, class: "back-link" do %>
    â† ëª©ë¡ìœ¼ë¡œ
  <% end %>

  <div class="detail-header">
    <div>
      <h1 class="detail-title"><%= @card_statement.filename %></h1>
      <div class="detail-meta">
        ì—…ë¡œë“œ: <%= @card_statement.created_at.strftime("%Y-%m-%d %H:%M") %>
        Â· ìƒíƒœ: <span class="history-badge badge-<%= @card_statement.status %>"><%= @card_statement.status_i18n %></span>
      </div>
    </div>
    <% if @card_statement.completed? %>
      <%= link_to new_expenses_report_path(card_statement_id: @card_statement.id), class: "btn-report" do %>
        ğŸ“‘ ì§€ì¶œê²°ì˜ì„œ ìƒì„±
      <% end %>
    <% end %>
  </div>

  <div class="status-card">
    <div class="stat-box">
      <div class="stat-value"><%= @card_statement.total_transactions %></div>
      <div class="stat-label">ì´ ê±°ë˜</div>
    </div>
    <div class="stat-box">
      <div class="stat-value"><%= @card_statement.classified_transactions %></div>
      <div class="stat-label">ë¶„ë¥˜ ì™„ë£Œ</div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: <%= @card_statement.progress_percentage %>%"></div>
      </div>
    </div>
    <div class="stat-box">
      <div class="stat-value"><%= @card_statement.card_summary.keys.size %></div>
      <div class="stat-label">ì¹´ë“œì‚¬</div>
    </div>
  </div>

  <div class="expense-table-card">
    <div class="table-header">
      <h2 class="table-title">ê±°ë˜ ë‚´ì—­</h2>
      <div class="filters">
        <%= form_with url: expenses_card_statement_path(@card_statement), method: :get, data: { turbo_frame: "_top" } do %>
          <select name="card_name" class="filter-select" onchange="this.form.submit()">
            <option value="">ì „ì²´ ì¹´ë“œì‚¬</option>
            <% @card_statement.card_summary.keys.each do |card| %>
              <option value="<%= card %>" <%= "selected" if params[:card_name] == card %>><%= card %></option>
            <% end %>
          </select>
          <select name="category" class="filter-select" onchange="this.form.submit()">
            <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
            <% Expense::CATEGORIES.each do |cat| %>
              <option value="<%= cat %>" <%= "selected" if params[:category] == cat %>><%= cat %></option>
            <% end %>
          </select>
        <% end %>
      </div>
    </div>

    <% if @expenses.any? %>
      <table class="expense-table">
        <thead>
          <tr>
            <th>ë‚ ì§œ</th>
            <th>ê°€ë§¹ì </th>
            <th>ì¹´ë“œì‚¬</th>
            <th>ì¹´í…Œê³ ë¦¬</th>
            <th>ë©”ëª¨</th>
            <th style="text-align: right">ê¸ˆì•¡</th>
          </tr>
        </thead>
        <tbody>
          <% @expenses.each do |expense| %>
            <tr>
              <td><%= expense.transaction_date.strftime("%Y-%m-%d") %></td>
              <td><%= expense.merchant %></td>
              <td><%= expense.card_name %></td>
              <td><span class="category-badge"><%= expense.category || "ë¯¸ë¶„ë¥˜" %></span></td>
              <td><%= expense.memo %></td>
              <td class="amount-cell"><%= expense.formatted_amount %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <div style="text-align: center; padding: 3rem; color: #9ca3af;">
        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“­</div>
        <div>ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    <% end %>
  </div>
</div>
