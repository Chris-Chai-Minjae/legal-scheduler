<%# Telegram ì„¤ì • í˜ì´ì§€ %>

<% content_for :title, "Telegram ì„¤ì • - Legal Scheduler AI" %>

<div class="settings-header">
  <h1>Telegram ì„¤ì •</h1>
  <p>Telegram Botì„ ì—°ê²°í•˜ì—¬ ì•Œë¦¼ì„ ë°›ìœ¼ì„¸ìš”</p>
</div>

<!-- Settings Tabs -->
<%= render "shared/settings_tabs" %>

<div class="section" style="padding: 32px;">
  <h2 class="section-title">Telegram ì—°ê²° ìƒíƒœ</h2>

  <% if @user.telegram_chat_id.present? && @user.telegram_bot_token.present? %>
    <!-- ì—°ê²°ë¨ -->
    <div class="status-box status-connected">
      <div class="status-icon">âœ…</div>
      <div class="status-content">
        <div class="status-title">ì—°ê²°ë¨</div>
        <div class="status-detail">Chat ID: <%= @user.telegram_chat_id %></div>
      </div>
      <div class="status-actions">
        <%= button_to "í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡", test_telegram_settings_path,
            method: :post,
            class: "btn btn-outline" %>
        <%= button_to "ì—°ê²° í•´ì œ", unlink_telegram_settings_path,
            method: :delete,
            class: "btn btn-secondary",
            data: { turbo_confirm: "ì •ë§ Telegram ì—°ê²°ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" } %>
      </div>
    </div>

    <div class="info-box">
      <div class="info-icon">ğŸ’¡</div>
      <div class="info-text">
        ì„œë©´ ì‘ì„± ì¼ì •ì´ ìƒì„±ë˜ë©´ Telegramìœ¼ë¡œ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.<br>
        ì•Œë¦¼ì—ì„œ ì§ì ‘ ìŠ¹ì¸/ê±°ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
    </div>

  <% else %>
    <!-- ë¯¸ì—°ê²° -->
    <div class="status-box status-warning">
      <div class="status-icon">âš ï¸</div>
      <div class="status-content">
        <div class="status-title">ì—°ê²°ë˜ì§€ ì•ŠìŒ</div>
        <div class="status-detail">ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì—¬ Telegramì„ ì—°ê²°í•´ì£¼ì„¸ìš”</div>
      </div>
    </div>

    <h3 class="subsection-title">ì—°ê²° ë°©ë²•</h3>

    <div class="steps-container">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <div class="step-title">Telegramì—ì„œ BotFatherë¡œ ë´‡ ìƒì„±</div>
          <div class="step-detail">@BotFather ê²€ìƒ‰ â†’ /newbot â†’ ë´‡ ì´ë¦„ ì…ë ¥ â†’ Bot Token ë³µì‚¬</div>
        </div>
      </div>
      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <div class="step-title">Chat ID í™•ì¸</div>
          <div class="step-detail">@userinfobot ê²€ìƒ‰ â†’ /start â†’ í‘œì‹œë˜ëŠ” Idê°€ Chat IDì…ë‹ˆë‹¤</div>
        </div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <div class="step-title">ìƒì„±í•œ ë´‡ê³¼ ëŒ€í™” ì‹œì‘</div>
          <div class="step-detail">ìƒì„±í•œ ë´‡ì„ ê²€ìƒ‰í•˜ì—¬ /start ì „ì†¡ (ë´‡ì´ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆê²Œ ë¨)</div>
        </div>
      </div>
      <div class="step">
        <div class="step-number">4</div>
        <div class="step-content">
          <div class="step-title">ì•„ë˜ ì •ë³´ ì…ë ¥</div>
          <div class="step-detail">Bot Tokenê³¼ Chat IDë¥¼ ì…ë ¥í•˜ê³  ì—°ê²°í•˜ê¸°</div>
        </div>
      </div>
    </div>

    <%= form_with url: link_telegram_settings_path, method: :post, local: true, class: "telegram-form" do %>
      <div class="form-group">
        <label for="bot_token">Bot Token</label>
        <input type="text" name="bot_token" id="bot_token"
            value="<%= @user.telegram_bot_token %>"
            placeholder="ì˜ˆ: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
            class="form-control" />
        <span class="form-hint">BotFatherì—ì„œ ë°›ì€ í† í°ì„ ì…ë ¥í•˜ì„¸ìš”</span>
      </div>

      <div class="form-group">
        <label for="chat_id">Chat ID</label>
        <input type="text" name="chat_id" id="chat_id"
            value="<%= @user.telegram_chat_id %>"
            placeholder="ì˜ˆ: 925514801"
            class="form-control" />
        <span class="form-hint">@userinfobotì—ì„œ í™•ì¸í•œ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”</span>
      </div>

      <div class="form-actions">
        <input type="submit" value="ì—°ê²°í•˜ê¸°" class="btn btn-primary" />
      </div>
    <% end %>
  <% end %>
</div>

<style>
  .settings-header {
    margin-bottom: 24px;
  }
  .settings-header h1 {
    font-size: 24px;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 4px;
  }
  .settings-header p {
    font-size: 14px;
    color: var(--gray-500);
  }
  .section-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 16px;
  }
  .subsection-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--gray-800);
    margin: 24px 0 16px;
  }

  /* Status Box */
  .status-box {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 24px;
  }
  .status-connected {
    background: #ECFDF5;
  }
  .status-warning {
    background: #FEF3C7;
  }
  .status-icon {
    font-size: 48px;
  }
  .status-content {
    flex: 1;
  }
  .status-title {
    font-weight: 600;
    font-size: 18px;
  }
  .status-connected .status-title {
    color: #065F46;
  }
  .status-warning .status-title {
    color: #92400E;
  }
  .status-detail {
    font-size: 14px;
    margin-top: 2px;
  }
  .status-connected .status-detail {
    color: #047857;
  }
  .status-warning .status-detail {
    color: #B45309;
  }
  .status-actions {
    display: flex;
    gap: 8px;
  }

  /* Steps */
  .steps-container {
    background: #F9FAFB;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
  }
  .step {
    display: flex;
    gap: 16px;
    margin-bottom: 16px;
  }
  .step:last-child {
    margin-bottom: 0;
  }
  .step-number {
    width: 32px;
    height: 32px;
    background: #2563EB;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    flex-shrink: 0;
  }
  .step-content {
    padding-top: 4px;
  }
  .step-title {
    font-weight: 500;
    color: var(--gray-900);
  }
  .step-detail {
    color: #6B7280;
    font-size: 14px;
    margin-top: 2px;
  }

  /* Form */
  .telegram-form {
    max-width: 500px;
  }
  .form-group {
    margin-bottom: 20px;
  }
  .form-group label {
    display: block;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 6px;
    font-size: 14px;
  }
  .form-control {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #D1D5DB;
    border-radius: 8px;
    font-size: 16px;
  }
  .form-control:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }
  .form-hint {
    display: block;
    margin-top: 4px;
    font-size: 12px;
    color: var(--gray-500);
  }
  .form-actions {
    padding-top: 8px;
  }

  /* Info Box */
  .info-box {
    display: flex;
    gap: 12px;
    padding: 16px;
    background: #F0F9FF;
    border: 1px solid #BFDBFE;
    border-radius: 8px;
  }
  .info-icon {
    font-size: 20px;
  }
  .info-text {
    font-size: 14px;
    color: var(--gray-700);
    line-height: 1.5;
  }

  /* Buttons */
  .btn {
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    text-decoration: none;
    display: inline-block;
  }
  .btn-primary {
    background: var(--primary, #2563EB);
    color: white;
  }
  .btn-primary:hover {
    background: #1D4ED8;
  }
  .btn-secondary {
    background: white;
    color: var(--gray-700, #374151);
    border: 1px solid var(--gray-300, #D1D5DB);
  }
  .btn-outline {
    background: transparent;
    color: #2563EB;
    border: 1px solid #2563EB;
  }
  .btn-outline:hover {
    background: #EFF6FF;
  }
</style>
